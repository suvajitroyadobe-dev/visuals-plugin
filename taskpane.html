<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Simple Icon Generator</title>
    <script src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js" type="text/javascript"></script>
    <style>
        body { font-family: sans-serif; padding: 15px; }
        input, button { width: 100%; padding: 10px; margin-top: 10px; box-sizing: border-box; }
        #btnGen { background: #0078d4; color: white; border: none; font-weight: bold; cursor: pointer; }
        #status { color: red; margin-top: 10px; font-size: 12px; border: 1px solid #ccc; padding: 5px; background: #eee; }
        #preview { margin-top: 10px; border: 1px dashed gray; min-height: 100px; text-align: center; }
        img { max-width: 100px; max-height: 100px; margin-top: 5px; }
    </style>
</head>
<body>
    <h3>Simple Icon Generator</h3>
    
    <label>API Key:</label>
    <input type="password" id="apiKey" placeholder="Paste Hugging Face Token...">
    
    <label>Icon Name:</label>
    <input type="text" id="prompt" placeholder="e.g. Cat">
    
    <button id="btnGen">GENERATE ICON</button>
    
    <div id="preview">Preview will appear here</div>
    <div id="status">Status: Ready</div>

    <script>
        Office.onReady(function(info) {
            document.getElementById("status").innerText = "Office Ready (" + info.host + ")";
            
            document.getElementById("btnGen").onclick = async function() {
                var key = document.getElementById("apiKey").value;
                var text = document.getElementById("prompt").value;
                var statusDiv = document.getElementById("status");
                
                if (!key || !text) {
                    statusDiv.innerText = "Error: API Key or Prompt missing!";
                    return;
                }

                statusDiv.innerText = "Step 1: Sending Request...";
                
                try {
                    // সার্ভারে রিকোয়েস্ট
                    const response = await fetch("https://suvajit01-sr-visuals-backend.hf.space/generate", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ 
                            prompt: text, 
                            api_key: key 
                        })
                    });

                    statusDiv.innerText = "Step 2: Waiting for Server...";
                    const data = await response.json();

                    if (data.image_data) {
                        statusDiv.innerText = "Step 3: Image Received! Inserting...";
                        
                        // প্রিভিউ দেখানো
                        var imgTag = '<img src="data:image/png;base64,' + data.image_data + '"/>';
                        document.getElementById("preview").innerHTML = imgTag;

                        // স্লাইডে বসানো
                        insertImage(data.image_data);
                    } else {
                        statusDiv.innerText = "Server Error: " + (data.error || "Unknown");
                    }

                } catch (error) {
                    statusDiv.innerText = "Network Error: " + error.message;
                }
            };
        });

        function insertImage(base64Code) {
            Office.context.document.setSelectedDataAsync(
                base64Code,
                { coercionType: Office.CoercionType.Image },
                function(result) {
                    var statusDiv = document.getElementById("status");
                    if (result.status === Office.AsyncResultStatus.Failed) {
                        statusDiv.innerText = "Insert Failed: " + result.error.message;
                    } else {
                        statusDiv.innerText = "SUCCESS! Icon Inserted.";
                    }
                }
            );
        }
    </script>
</body>
</html>
