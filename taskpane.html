<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <title>SR Visuals</title>
    <script src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js" type="text/javascript"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background-color: #f3f2f1; }
        .header { background: #ffffff; padding: 15px; text-align: center; border-bottom: 1px solid #e1dfdd; }
        .header h1 { margin: 0; color: #d83b01; font-size: 20px; }
        
        /* সেটিংস */
        .settings-bar { display: flex; justify-content: flex-end; padding: 5px 10px; background: #f4f4f4; border-bottom: 1px solid #ddd; }
        .settings-content { padding: 15px; background: #fffbe6; border-bottom: 1px solid #ddd; display: none; }
        .api-input { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; box-sizing: border-box; }

        /* ট্যাব */
        .tabs { overflow: hidden; background-color: #f1f1f1; display: flex; border-bottom: 1px solid #ccc; }
        .tab-btn { background-color: inherit; border: none; outline: none; cursor: pointer; padding: 10px; transition: 0.3s; font-size: 14px; flex: 1; }
        .tab-btn:hover { background-color: #ddd; }
        .tab-btn.active { background-color: #d83b01; color: white; }

        .content { padding: 15px; background: white; min-height: 400px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* ইনপুটস */
        textarea { width: 100%; height: 80px; padding: 10px; border: 1px solid #ccc; margin-top: 10px; box-sizing: border-box; resize: vertical; }
        .style-options { margin: 15px 0; }
        .style-options label { margin-right: 15px; cursor: pointer; }

        /* বাটন */
        .primary-btn, .insert-btn { width: 100%; padding: 10px; background-color: #0078d4; color: white; border: none; cursor: pointer; font-size: 14px; margin-top: 10px; font-weight: bold; }
        .primary-btn:hover { background-color: #005a9e; }
        .insert-btn { background-color: #107c10; margin-top: 5px; }

        /* রেজাল্ট ও লোডিং */
        .svg-box { border: 1px dashed #ccc; padding: 10px; margin-top: 10px; background: #fafafa; text-align: center; min-height: 100px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #d83b01; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .blink-text { animation: blinker 1.5s linear infinite; color: #d83b01; font-weight: bold; margin-top: 10px; }
        @keyframes blinker { 50% { opacity: 0.3; } }
    </style>
</head>

<body class="ms-font-m">

    <div class="settings-bar">
        <button id="btnSettings" style="cursor:pointer; background:none; border:none; font-size:16px;">⚙️ Settings</button>
    </div>
    
    <div id="settingsPanel" class="settings-content">
        <label class="ms-font-s">Select API Type:</label>
        <select id="apiType" class="api-input">
            <option value="huggingface">Hugging Face</option>
        </select>
        <label class="ms-font-s" style="margin-top:10px; display:block;">Enter your API Key:</label>
        <input type="password" id="userApiKey" class="api-input" placeholder="Paste HF Token here...">
    </div>

    <header class="header">
        <h1>SR Visuals</h1>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('iconTab')">Icon</button>
        <button class="tab-btn" onclick="openTab('infoTab')">Infographic</button>
        <button class="tab-btn" onclick="openTab('imgTab')">Img2Vec</button>
    </div>

    <main class="content">
        <div id="iconTab" class="tab-content active">
            <label class="ms-font-m">Describe your Icon:</label>
            <textarea id="iconInput" placeholder="E.g., A minimalist red apple..."></textarea>
            
            <div class="style-options">
                <label><input type="radio" name="iconStyle" value="napkin" checked> Sketch</label>
                <label><input type="radio" name="iconStyle" value="geometric"> Geometric</label>
                <label><input type="radio" name="iconStyle" value="3d"> 3D Render</label>
            </div>
            
            <button id="btnGenerateIcon" class="primary-btn">Generate Icon</button>
        </div>

        <div id="infoTab" class="tab-content">
            <p style="color: #666; text-align: center;">Infographic coming soon...</p>
        </div>
        <div id="imgTab" class="tab-content">
            <p style="color: #666; text-align: center;">Img2Vec coming soon...</p>
        </div>

        <div id="loading" style="display:none; text-align:center; padding: 20px;">
            <div class="spinner"></div>
            <p class="blink-text">Generating Icon... Please wait.</p>
        </div>

        <div id="resultArea" style="display:none;">
            <h3 class="ms-font-m">Preview:</h3>
            <div id="svgContainer" class="svg-box"></div>
            <input type="hidden" id="hiddenRawImage" value="">
            <button id="btnInsert" class="insert-btn">Insert to Slide</button>
        </div>
    </main>

    <script>
        // --- ট্যাব এবং সেটিংস লজিক ---
        function openTab(tabName) {
            var i, x, tablinks;
            x = document.getElementsByClassName("tab-content");
            for (i = 0; i < x.length; i++) { x[i].style.display = "none"; }
            tablinks = document.getElementsByClassName("tab-btn");
            for (i = 0; i < tablinks.length; i++) { tablinks[i].className = tablinks[i].className.replace(" active", ""); }
            document.getElementById(tabName).style.display = "block";
            event.currentTarget.className += " active";
        }

        document.getElementById("btnSettings").onclick = function() {
            var panel = document.getElementById("settingsPanel");
            panel.style.display = (panel.style.display === "block") ? "none" : "block";
        };

        // --- Office.js ইনিশিয়ালাইজেশন ---
        Office.onReady((info) => {
            if (info.host === Office.HostType.PowerPoint) {
                console.log("Office Ready!");
                // বাটন ক্লিক ইভেন্ট
                document.getElementById("btnGenerateIcon").onclick = handleTextToIcon;
                document.getElementById("btnInsert").onclick = manualInsert;
            }
        });

        // --- মেইন লজিক ---
        async function handleTextToIcon() {
            // ১. বাটনে চাপ লেগেছে কি না পরীক্ষা
            console.log("Button Clicked!"); 

            const rawInput = document.getElementById("iconInput").value;
            const apiType = document.getElementById("apiType").value;
            const userApiKey = document.getElementById("userApiKey").value;
            let style = "napkin";
            const styleElem = document.querySelector('input[name="iconStyle"]:checked');
            if (styleElem) style = styleElem.value;

            if (!rawInput) {
                // ইনপুট বক্স লাল করে দেওয়া হবে
                document.getElementById("iconInput").style.border = "2px solid red";
                return;
            } else {
                document.getElementById("iconInput").style.border = "1px solid #ccc";
            }

            // ২. লোডিং শুরু
            document.getElementById("loading").style.display = "block";
            document.getElementById("resultArea").style.display = "none";

            try {
                // ৩. সার্ভার কল
                const response = await fetch("https://suvajit01-sr-visuals-backend.hf.space/generate-icon", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ 
                        prompt: rawInput, 
                        style: style, 
                        api_type: apiType, 
                        user_key: userApiKey 
                    }),
                });

                const data = await response.json();
                console.log("Server Response:", data);

                if (data.raw_image) {
                    // ৪. সফল হলে প্রিভিউ দেখানো
                    const container = document.getElementById("svgContainer");
                    container.innerHTML = data.svg; // SVG প্রিভিউ
                    
                    // ইমেজ ডাটা সংরক্ষণ করে রাখা
                    document.getElementById("hiddenRawImage").value = data.raw_image;
                    
                    document.getElementById("resultArea").style.display = "block";

                    // ৫. স্লাইডে পাঠানো
                    insertToSlide(data.raw_image);
                } else {
                    alert("Error: " + (data.error || "Generation Failed"));
                }
            } catch (error) {
                console.error(error);
                alert("Connection Error! Check internet or API Key.");
            } finally {
                document.getElementById("loading").style.display = "none";
            }
        }

        function insertToSlide(base64Code) {
            if (!base64Code) return;

            // সরাসরি ইমেজ হিসেবে বসানো (সবচেয়ে নিরাপদ)
            Office.context.document.setSelectedDataAsync(
                base64Code,
                { coercionType: Office.CoercionType.Image },
                (result) => {
                    if (result.status === Office.AsyncResultStatus.Failed) {
                        console.error(result.error.message);
                        alert("Insert Failed: " + result.error.message);
                    } else {
                        console.log("Success!");
                    }
                }
            );
        }

        function manualInsert() {
            const imgData = document.getElementById("hiddenRawImage").value;
            if (imgData) insertToSlide(imgData);
            else alert("No icon generated yet!");
        }
    </script>
</body>
</html>
এখানে ফাইল বিষয়বস্তু লিখুন
